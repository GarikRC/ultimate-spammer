/*!CK:1218004359!*//*1443735775,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["5Vi8b"]); }

__d('AjaxRequest',['ErrorUtils','Keys','PHPQuerySerializer','TimeSlice','URI','UserAgent_DEPRECATED','getSameOriginTransport','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();function p(t,u,v){this.xhr=n();if(!(u instanceof l))u=new l(u);if(v&&t=='GET'){u.setQueryData(v);}else this._params=v;this.method=t;this.uri=u;this.xhr.open(t,u);}var q=window.XMLHttpRequest&&'withCredentials' in new XMLHttpRequest();p.supportsCORS=function(){return q;};p.ERROR='ar:error';p.TIMEOUT='ar:timeout';p.PROXY_ERROR='ar:proxy error';p.TRANSPORT_ERROR='ar:transport error';p.SERVER_ERROR='ar:http error';p.PARSE_ERROR='ar:parse error';p.SERVICE_UNAVAILABLE='ar:noservice';p._inflight=[];function r(){var t=p._inflight;p._inflight=[];t.forEach(function(u){u.abort();});}function s(t){t.onJSON=t.onError=t.onSuccess=null;clearTimeout(t._timer);if(t.xhr&&t.xhr.readyState<4){t.xhr.abort();t.xhr=null;}p._inflight=p._inflight.filter(function(u){return u&&u!=t&&u.xhr&&u.xhr.readyState<4;});}Object.assign(p.prototype,{timeout:60000,streamMode:true,prelude:/^for \(;;\);/,status:null,_eol:-1,_call:function(t){if(this[t])this[t](this);},_parseStatus:function(){var t;try{this.status=this.xhr.status;t=this.xhr.statusText;}catch(u){if(this.xhr.readyState>=4){this.errorType=p.TRANSPORT_ERROR;this.errorText=u.message;}return;}if(this.status===0&&!/^(file|ftp)/.test(this.uri)){this.errorType=p.TRANSPORT_ERROR;}else if(this.status>=100&&this.status<200){this.errorType=p.PROXY_ERROR;}else if(this.status>=200&&this.status<300){return;}else if(this.status>=300&&this.status<400){this.errorType=p.PROXY_ERROR;}else if(this.status>=400&&this.status<500){this.errorType=p.SERVER_ERROR;}else if(this.status===503){this.errorType=p.SERVICE_UNAVAILABLE;}else if(this.status>500&&this.status<600){this.errorType=p.PROXY_ERROR;}else if(this.status==1223){return;}else if(this.status>=12001&&this.status<=12156){this.errorType=p.TRANSPORT_ERROR;}else{t='unrecognized status code: '+this.status;this.errorType=p.ERROR;}if(!this.errorText)this.errorText=t;},_parseResponse:function(){var t,u=this.xhr.readyState;try{t=this.xhr.responseText||'';}catch(v){if(u>=4){this.errorType=p.ERROR;this.errorText='responseText not available - '+v.message;}return;}while(this.xhr){var w=this._eol+1,x=this.streamMode?t.indexOf('\n',w):t.length;if(x<0&&u==4)x=t.length;if(x<=this._eol)break;var y=t;if(this.streamMode)y=t.substr(w,x-w).replace(/^\s*|\s*$/g,'');if(w===0&&this.prelude)if(this.prelude.test(y))y=y.replace(this.prelude,'');this._eol=x;if(y){try{this.json=JSON.parse(y);}catch(v){var z=/(<body[\S\s]+?<\/body>)/i.test(t)&&RegExp.$1,aa={message:v.message,'char':w,excerpt:(w===0&&z||y).substr(512)};this.errorType=p.PARSE_ERROR;this.errorText='parse error - '+JSON.stringify(aa);return;}h.applyWithGuard(this._call,this,['onJSON']);}}},_onReadyState:function(){var t=this.xhr&&this.xhr.readyState||0;if(this.status==null&&t>=2)this._parseStatus();if(!this.errorType&&this.status!=null)if(t==3&&this.streamMode||t==4)this._parseResponse();if(this.errorType||t==4){this._time=Date.now()-this._sentAt;this._call(!this.errorType?'onSuccess':'onError');s(this);}},send:function(t){this.xhr.onreadystatechange=k.guard(this._onReadyState.bind(this),'AjaxRequest xhr.onreadystatechange');var u=this.timeout;if(u)this._timer=o((function(){this.errorType=p.TIMEOUT;this.errorText='timeout';this._time=Date.now()-this._sentAt;this._call('onError');s(this);}).bind(this),u);p._inflight.push(this);if(this.method=='POST')this.xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');this._sentAt=Date.now();this.xhr.send(t?j.serialize(t):'');},abort:function(){s(this);},toString:function(){var t='[AjaxRequest readyState='+this.xhr.readyState;if(this.errorType)t+=' errorType='+this.errorType+' ('+this.errorText+')';return t+']';},toJSON:function(){var t={json:this.json,status:this.status,errorType:this.errorType,errorText:this.errorText,time:this._time};if(this.errorType)t.uri=this.uri;for(var u in t)if(t[u]==null)delete t[u];return t;}});if(window.addEventListener&&m.firefox())window.addEventListener('keydown',function(event){if(event.keyCode===i.ESC)event.prevent();},false);if(window.attachEvent)window.attachEvent('onunload',r);f.exports=p;},null);
__d('ChannelSubdomain',['Event','JSLogger','Run','setTimeoutAcrossTransitions','LogHistory','WebStorage'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l=c('LogHistory').getInstance('channel'),m=c('WebStorage').getLocalStorage(),n=i.create('channel'),o='channel_sub:',p=7,q=100*1000,r=null,s;function t(){if(s){clearTimeout(s);s=null;}if(m&&r!=null)m.removeItem(o+r);r=null;}function u(v,w,x){var y=(v-1)*p;if(x){if(s)clearTimeout(s);r=s=null;}if(w==null)w=Math.floor(Math.random()*y);if(r==null)if(m){var z=[];for(var aa=0;aa<m.length;aa++){var ba=m.key(aa);if(ba.indexOf(o)===0){var ca=parseInt(ba.substr(o.length),10);z[ca]=parseInt(m.getItem(ba),10);}}var da=Date.now()-q;for(aa=0;aa<y;aa++){var ea=(aa+w)%y;if(!z[ea]||z[ea]<da){r=ea;break;}}if(r!=null){var fa=function(){try{m.setItem(o+r,Date.now());}catch(ga){l.warn('subdomain set failed',ga.message);}s=k(fa,q/2);};fa();}else{l.warn('no channel subdomain',z);n.error('subdomain_overflow');}if(typeof window.onpageshow!='undefined'){h.listen(window,'pagehide',t);}else j.onUnload(t);}else r=w;return r==null?null:r%p;}f.exports={allocate:u,clear:t};},null);
__d('DocRPC',['ErrorUtils'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i={_apis:{},_dispatch:function(j){var k;try{j=JSON.parse(j);}catch(l){throw new Error('DocRPC unparsable dispatch: "'+j+'"');}if(i._apis.hasOwnProperty(j.api)){var m=i._apis[j.api];if(m[j.method])k=h.applyWithGuard(m[j.method],m,j.args);}if(k===undefined)k=null;return JSON.stringify(k);},publish:function(j,k){i._apis[k]=j;},proxy:function(j,k,l){var m={};l.forEach(function(n){m[n]=function(){var o={api:k,method:n,args:Array.prototype.slice.call(arguments)},p;try{if(j.closed)throw new Error('DocRPC window closed');p=j.DocRPC._dispatch(JSON.stringify(o));}catch(q){h.reportError(q);return;}if(typeof p=='string')try{p=JSON.parse(p);}catch(q){throw new Error('DocRPC '+k+'.'+n+' unparsable return: "'+p+'"');}return p;};});return m;}};f.exports=b.DocRPC=i;},null);
__d('ChannelTransport',['AjaxRequest','ChannelConstants','DocRPC','LogHistory','TimeSlice','URI','bind','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();var p=k.getInstance('channel');function q(){return (1048576*Math.random()|0).toString(36);}function r(ba,ca){var da=ba.subdomain;da=da===null?'':da+'-';var ea=new m(ca).setDomain(da+ba.host+'.'+ba.domain).setPort(ba.port).setSecure(new m(window.location.href).isSecure());return ea;}function s(ba){var ca={partition:ba.partition,cb:q()};if(ba.sticky_token)ca.sticky_token=ba.sticky_token;var da=r(ba,'/p').setQueryData(ca);p.log('start_p',{uri:da.toString()});var ea=new h('GET',da);if(h.supportsCORS())ea.xhr.withCredentials=true;var fa=function(ga){p.log('finish_p',{xhr:ga.toJSON?ga.toJSON():ga});};ea.timeout=ba.P_TIMEOUT;ea.onError=ea.onSuccess=fa;ea.send();}function t(ba,ca,da){var ea=new Image(),fa=0,ga=function(ja){ea.abort();return ja?ca():da();};ea.onload=l.guard(function(){p.log('ping_ok',{duration:Date.now()-fa});ga(true);},'ChannelTransport image.onload');ea.onerror=l.guard(function(){s(ba);ga(false);},'ChannelTransport image.onerror');var ha=o(ea.onerror,10000);ea.abort=function(){if(ha){clearTimeout(ha);ha=null;}ea.onload=ea.onerror=null;};var ia={partition:ba.partition,cb:q()};if(ba.sticky_token)ia.sticky_token=ba.sticky_token;if(ba.sticky_pool)ia.sticky_pool=ba.sticky_pool;if(ba.lastRequestErrorReason){ia.reason=ba.lastRequestErrorReason;ba.lastRequestErrorReason=null;}if(ba.uid&&ba.viewerUid){ia.uid=ba.uid;ia.viewer_uid=ba.viewerUid;}if(ba.watchdog&&ba.watchdog.enabled)ia.wtc=ba.watchdog.doSerialize();fa=Date.now();ea.src=r(ba,'/ping').setQueryData(ia);return ea;}function u(ba,ca){var da={channel:ba.user_channel,partition:ba.partition,clientid:ba.sessionID,cb:q(),cap:0,uid:ba.uid,viewer_uid:ba.viewerUid};if(ba.sticky_token)da.sticky_token=ba.sticky_token;if(ba.sticky_pool)da.sticky_pool=ba.sticky_pool;if(ba.profile)da.profile=ba.profile;if(ba.capabilities)da.cap=ba.capabilities;da.id=ca;var ea=r(ba,'/add_bud').setQueryData(da),fa=new h('GET',ea);if(h.supportsCORS())fa.xhr.withCredentials=true;fa.onError=function(ga){p.warn('add_buddy_error');};fa.onSuccess=function(ga){p.log('add_buddy_ok');};fa.timeout=ba.P_TIMEOUT;fa.send();}function v(ba){var ca={channel:ba.user_channel,partition:ba.partition,clientid:ba.sessionID,cb:q(),cap:0,uid:ba.uid,viewer_uid:ba.viewerUid};if(ba.sticky_token)ca.sticky_token=ba.sticky_token;if(ba.sticky_pool)ca.sticky_pool=ba.sticky_pool;if(ba.is_offline||ba.shouldSuppressPresence){ca.state='offline';}else ca.state='active';if(ca.state===ba.lastPresenceState)return;ba.lastPresenceState=ca.state;if(ba.profile)ca.profile=ba.profile;if(ba.capabilities)ca.cap=ba.capabilities;var da=r(ba,'/active_ping').setQueryData(ca),ea=new h('GET',da);if(h.supportsCORS())ea.xhr.withCredentials=true;ea.onError=function(fa){p.warn('active_ping_error');};ea.onSuccess=function(fa){p.log('active_ping_ok');};ea.timeout=ba.P_TIMEOUT;ea.send();}function w(ba,ca,da,ea){var fa=new Date(),ga=-1;if(ba.userActive>0){ga=(fa-ba.userActive)/1000|0;if(ga<0)p.warn('idle_regression',{idleTime:ga,now:fa.getTime(),userActive:ba.userActive});}var ha={channel:ba.user_channel,seq:ba.seq,partition:ba.partition,clientid:ba.sessionID,cb:q(),idle:ga,qp:'y',cap:0};if(!!ba.watchdog&&ba.watchdog.enabled)ha.wtc=ba.watchdog.doSerialize();if(ba.ready)if(ba.seqTurSentAt==-1||ba.seqTurSentAt==ba.seq){ha.tur=ba.timeUntilReady;ha.qpmade=ba.queueMade;ba.seqTurSentAt=ba.seq;}ha.msgs_recv=ba.estimatedReceived;if(ba.uid&&ba.viewerUid){ha.uid=ba.uid;ha.viewer_uid=ba.viewerUid;}if(ba.stableDeviceId)ha.sdi=1;if(ba.sticky_token){ha.sticky_token=ba.sticky_token;}else if(ba.msgr_region)ha.msgr_region=ba.msgr_region;if(ba.sticky_pool)ha.sticky_pool=ba.sticky_pool;if('trace_id' in ba)ha.traceid=ba.trace_id;if(ba.is_offline||ba.shouldSuppressPresence){ha.state='offline';}else if(ba.userActive>0&&ga<60)ha.state='active';ba.lastPresenceState=ha.state;if(ba.streamingCapable){ha.mode='stream';ha.format='json';}if(ba.profile)ha.profile=ba.profile;if(ba.capabilities)ha.cap=ba.capabilities;var ia=r(ba,'/pull').setQueryData(ha),ja=ba.fantail_enabled?'POST':'GET',ka=new h(ja,ia);if(h.supportsCORS())ka.xhr.withCredentials=true;ka.timeout=ba.streamingCapable?ba.STREAMING_TIMEOUT:ba.LONGPOLL_TIMEOUT;ka.onJSON=ca;ka.onSuccess=da;ka.onError=function(){var na=this.status==12002&&this._time>=ba.MIN_12002_TIMEOUT||this.status==504&&this._time>=ba.MIN_504_TIMEOUT,oa=na?da:ea;return oa&&oa.apply(this,arguments);};if(ba.fantail_logs&&ba.fantail_logs.length>0){var la={};for(var ma=0;ma<ba.fantail_logs.length;ma++)Object.assign(la,ba.fantail_logs[ma]);ka.send(la);ba.fantail_logs=[];}else ka.send();ba.inStreaming=ba.streamingCapable;return ka;}function x(ba){this.manager=ba;this.init&&this.init();}function y(ba){x.apply(this,arguments);}Object.assign(y.prototype,{logName:'CORS',enterState:function(ba,ca){if(this._request){this._request.abort();this._request=null;}if(ba=='init')o(n(this.manager,'exitState',{status:i.OK,stateId:ca.stateId}),ca.fullReloadAsSuccess?0:3000);if(!/pull|ping/.test(ba))return;var da=this.manager;if(ba=='ping'){this._request=t(ca,n(da,'exitState',{status:i.OK,stateId:ca.stateId}),n(da,'exitState',{status:i.ERROR,stateId:ca.stateId}));}else if(ba=='pull')this._request=w(ca,n(da,'_processTransportData',ca.stateId),n(da,'exitState',{status:i.OK,stateId:ca.stateId}),n(da,'exitState',{status:i.ERROR,stateId:ca.stateId}));}});function z(ba){p.log('iframe_init_constructor');x.apply(this,arguments);this._iframe=document.createElement('iframe');this._iframe.style.display='none';document.body.appendChild(this._iframe);j.publish(this,'outerTransport');}Object.assign(z.prototype,{logName:'iframe',_initIframe:function(ba){p.log('iframe_init_start');window.onchanneliframeready=function(){p.log('iframe_resources');return ba.resources;};window.onchanneliframeloaded=function(){p.log('iframe_loaded');};if(ba){this._iframeURI=r(ba,ba.path);if(ba.resources){var ca=this._iframeURI.getDomain();ba.resources=ba.resources.map(function(fa){var ga=new m(fa);if(ga.getPath().startsWith('/intern/rsrc.php')&&ga.getQueryData().origin!==undefined)return ga.addQueryData('origin',ca).toString();return fa;});}if(ba.bustIframe){var da={partition:ba.partition,cb:q()};this._iframeURI.setQueryData(da);}}else this._iframeURI='about:blank';this._iframeProxy=null;try{this._iframe.contentWindow.location.replace(this._iframeURI);p.log('iframe_uri_set');}catch(ea){p.error('iframe_uri_set_error',ea);this.exitState({status:i.ERROR,stateId:ba.stateId},ea+'');}},enterState:function(ba,ca){if(ba=='init'){this._initIframe(ca);}else if(/idle|ping|pull/.test(ba)){if(this._iframeProxy){this._iframeProxy.enterState.apply(this._iframeProxy,arguments);}else if(ba!='idle')this.exitState({status:i.ERROR,stateId:ca.stateId},'iframe not yet loaded');}else if(ba=='shutdown')this._initIframe();},_processTransportData:function(){this.manager._processTransportData.apply(this.manager,arguments);},exitState:function(ba){if(this.manager.state=='init'&&ba.status==i.OK)this._iframeProxy=j.proxy(this._iframe.contentWindow,'innerTransport',['enterState'],(this._iframeURI+'').replace(/iframe.*/,''));if(/ping|pull/.test(this.manager.state)&&!this._iframeProxy)return;this.manager.exitState.apply(this.manager,arguments);}});function aa(){this.init=this.init.bind(this);x.apply(this,arguments);}Object.assign(aa.prototype,{logName:'iframe(inner)',init:function(){j.publish(this,'innerTransport');try{var ca=j.proxy(window.parent,'outerTransport',['_processTransportData','exitState'],top.DocRPC.origin);Object.assign(this,ca);this.exitState({status:i.OK,stateId:1e+06});}catch(ba){p.error('iframe_inner_init_error',ba);}},enterState:function(ba,ca){if(this._request){this._request.abort();this._request=null;}if(ba=='ping'){this._request=t(ca,n(this,'exitState',{status:i.OK,stateId:ca.stateId}),n(this,'exitState',{status:i.ERROR,stateId:ca.stateId}));}else if(ba=='pull')this._request=w(ca,n(this,'_processTransportData',ca.stateId),n(this,'exitState',{status:i.OK,stateId:ca.stateId}),n(this,'exitState',{status:i.ERROR,stateId:ca.stateId}));}});f.exports={getURI:r,Transport:x,CORSTransport:y,IframeTransport:z,IframeInnerTransport:aa,sendActivePing:v,sendAdditionalBuddyRequest:u};},null);
__d('FBAjaxRequest',['AjaxRequest','getAsyncParams'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();function j(k,l,m){m=babelHelpers._extends({},i(k),m);var n=new h(k,l,m);n.streamMode=false;var o=n._call;n._call=function(p){if(p=='onJSON'&&this.json){if(this.json.error){this.errorType=h.SERVER_ERROR;this.errorText='AsyncResponse error: '+this.json.error;}this.json=this.json.payload;}o.apply(this,arguments);};n.ajaxReqSend=n.send;n.send=function(p){this.ajaxReqSend(babelHelpers._extends({},p,m));};return n;}f.exports=j;},null);
__d("MovingStat",[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i){i=i||60000;var j={t:new Date(),count:0,v:0},k=j,l=0,m=0;function n(){var o=new Date()-i;while(k&&k.next&&k.t<o){l-=k.v;m-=k.count;k=k.next;}}this.add=function(o){l+=o;m++;var p=new Date();if(p-j.t<1000){j.v+=o;j.count++;}else{j.next={t:p,v:o,count:1};j=j.next;n();}};this.tally=function(o){o=o||1000;n();return {sum:l,count:m,timeAverage:l*o/i};};}f.exports=h;},null);
__d('Dcode',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h,i={},j={_:'%',A:'%2',B:'000',C:'%7d',D:'%7b%22',E:'%2c%22',F:'%22%3a',G:'%2c%22ut%22%3a1',H:'%2c%22bls%22%3a',I:'%2c%22n%22%3a%22%',J:'%22%3a%7b%22i%22%3a0%7d',K:'%2c%22pt%22%3a0%2c%22vis%22%3a',L:'%2c%22ch%22%3a%7b%22h%22%3a%22',M:'%7b%22v%22%3a2%2c%22time%22%3a1',N:'.channel%22%2c%22sub%22%3a%5b',O:'%2c%22sb%22%3a1%2c%22t%22%3a%5b',P:'%2c%22ud%22%3a100%2c%22lc%22%3a0',Q:'%5d%2c%22f%22%3anull%2c%22uct%22%3a',R:'.channel%22%2c%22sub%22%3a%5b1%5d',S:'%22%2c%22m%22%3a0%7d%2c%7b%22i%22%3a',T:'%2c%22blc%22%3a1%2c%22snd%22%3a1%2c%22ct%22%3a',U:'%2c%22blc%22%3a0%2c%22snd%22%3a1%2c%22ct%22%3a',V:'%2c%22blc%22%3a0%2c%22snd%22%3a0%2c%22ct%22%3a',W:'%2c%22s%22%3a0%2c%22blo%22%3a0%7d%2c%22bl%22%3a%7b%22ac%22%3a',X:'%2c%22ri%22%3a0%7d%2c%22state%22%3a%7b%22p%22%3a0%2c%22ut%22%3a1',Y:'%2c%22pt%22%3a0%2c%22vis%22%3a1%2c%22bls%22%3a0%2c%22blc%22%3a0%2c%22snd%22%3a1%2c%22ct%22%3a',Z:'%2c%22sb%22%3a1%2c%22t%22%3a%5b%5d%2c%22f%22%3anull%2c%22uct%22%3a0%2c%22s%22%3a0%2c%22blo%22%3a0%7d%2c%22bl%22%3a%7b%22ac%22%3a'};(function(){var l=[];for(var m in j){i[j[m]]=m;l.push(j[m]);}l.reverse();h=new RegExp(l.join("|"),'g');})();var k={encode:function(l){return encodeURIComponent(l).replace(/([_A-Z])|%../g,function(m,n){return n?'%'+n.charCodeAt(0).toString(16):m;}).toLowerCase().replace(h,function(m){return i[m];});},decode:function(l){return decodeURIComponent(l.replace(/[_A-Z]/g,function(m){return j[m];}));}};f.exports=k;},null);
__d('PresenceCookieManager',['Cookie','CurrentUser','Dcode','ErrorUtils','JSLogger','PresenceInitialData','PresenceUtil','URI'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();var p=m.cookieVersion,q=m.dictEncode,r='presence',s={},t=null,u=null,v=l.create('presence_cookie');function w(){try{var aa=h.get(r);if(t!==aa){t=aa;u=null;if(aa&&aa.charAt(0)=='E')aa=j.decode(aa.substring(1));if(aa)u=JSON.parse(aa);}if(u){if(u.user&&u.user!==i.getID())return null;if(u.v!==p)return null;return u;}}catch(z){v.warn('getcookie_error',z);}return null;}function x(){return parseInt(Date.now()/1000,10);}var y={register:function(z,aa){s[z]=aa;},store:function(){var z=w();if(z&&z.v&&p<z.v){v.debug('stale_cookie',p);return;}var aa={v:p,time:x(),user:i.getID()};for(var ba in s)aa[ba]=k.applyWithGuard(s[ba],s,[z&&z[ba]],function(fa){fa.presence_subcookie=ba;});var ca=JSON.stringify(aa);if(q)ca='E'+j.encode(ca);if(n.hasUserCookie()){var da=ca.length;if(da>1024)v.warn('big_cookie',da);var ea=o.getRequestURI(false).isSecure()&&!!h.get('csm');h.set(r,ca,null,null,ea);}},clear:function(){h.clear(r);},getSubCookie:function(z){var aa=w();if(!aa)return null;return aa[z];}};f.exports=y;},null);
__d('PresenceState',['Arbiter','ErrorUtils','JSLogger','PresenceCookieManager','debounceAcrossTransitions','setIntervalAcrossTransitions','PresenceInitialData'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();var o=n.cookiePollInterval||2000,p=n.shouldSuppress||false,q=[],r=[],s=null,t=null,u=0,v=null,w=0,x=['sb2','t2','lm2','uct2','tr','tw','at','wml'],y=j.create('presence_state');function z(){return k.getSubCookie('state');}function aa(){u=Date.now();k.store();ea(t);}var ba=l(aa,0);function ca(ja){if(typeof ja=='undefined'||isNaN(ja)||ja==Number.POSITIVE_INFINITY||ja==Number.NEGATIVE_INFINITY)ja=0;return ja;}function da(ja){var ka={};if(ja){x.forEach(function(na){ka[na]=ja[na];});if(u<ja.ut)y.error('new_cookie',{cookie_time:ja.ut,local_time:u});}ka.ut=u;for(var la=0,ma=q.length;la<ma;la++)i.applyWithGuard(q[la],null,[ka]);t=ka;return t;}function ea(ja){w++;u=ca(ja.ut);if(!s)s=m(ha,o);t=ja;if(v===null)v=ja;for(var ka=0,la=r.length;ka<la;ka++)i.applyWithGuard(r[ka],null,[ja]);w--;}function fa(ja){if(ja&&ja.ut)if(u<ja.ut){return true;}else if(ja.ut<u)y.error('old_cookie',{cookie_time:ja.ut,local_time:u});return false;}function ga(){var ja=z();if(fa(ja))t=ja;return t;}function ha(){var ja=z();if(fa(ja))ea(ja);}k.register('state',da);h.subscribe(j.DUMP_EVENT,function(ja,ka){ka.presence_state={initial:babelHelpers._extends({},v),state:babelHelpers._extends({},t),update_time:u,sync_paused:w,poll_time:o};});(function(){var ja=ga();if(ja){ea(ja);}else{y.debug('no_cookie_initial');ea(da());return;}})();var ia={doSync:function(ja){if(w)return;if(ja){aa();}else ba();},registerStateStorer:function(ja){q.push(ja);},registerStateLoader:function(ja){r.push(ja);},get:function(){return ga();},getInitial:function(){return v;},shouldSuppress:function(){return p;},verifyNumber:ca};f.exports=ia;},null);
__d('RTISession',['URI','AjaxRequest','invariant','ErrorUtils'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l='.facebook.com';function m(n,o,p,q,r,s,t,u,v){!n?j(0):undefined;!q?j(0):undefined;!r?j(0):undefined;this.domain=n;this.port=o;this.edgePoolName=p;this.stickyToken=q;this.loggedInId=r;this.accountId=s;this.clientProfile=t||'desktop';this.clientId=u;this.capabilities=v;}m.prototype.issueRequest=function(n,o,p,q,r){!n?j(0):undefined;!o?j(0):undefined;!q?j(0):undefined;var s=this.domain.length-l.length,t=s>0&&this.domain.indexOf(l,s)!==-1,u=t?this.domain:this.domain+l,v=(1048576*Math.random()|0).toString(36),w={cb:v,sticky_token:this.stickyToken,uid:this.loggedInId,viewer_uid:this.accountId,sticky_pool:this.edgePoolName,profile:this.clientProfile,clientid:this.clientId,cap:this.capabilities};for(var x in w)!!o[x]?j(0):undefined;Object.assign(w,o);var y=new h(n).setDomain(u).setPort(this.port).setSecure(new h(window.location.href).isSecure()).setQueryData(w),z=p?'POST':'GET',aa=new i(z,y);aa.timeout=r?r*1000:30000;if(aa.xhr)aa.xhr.withCredentials=true;var ba={};aa.onSuccess=function(){};aa.onJSON=(function(){ba.data=aa.json;ba.error=null;k.applyWithGuard(q,this,[ba]);}).bind(this);aa.onError=(function(){ba.data=null;ba.error=aa.errorType||'error';k.applyWithGuard(q,this,[ba]);}).bind(this);aa.send(JSON.stringify(p));};f.exports=m;},null);
__d('ChannelManager',['AjaxRequest','Arbiter','AsyncRequest','ChannelConstants','ChannelInitialData','ChannelSubdomain','ChannelTransport','ChatVisibility','DTSG','Env','FBAjaxRequest','ISB','JSLogger','MessagingRealtimeConstants','MovingStat','PresenceCookieManager','PresenceState','PresenceUtil','Run','SystemEvents','URI','UserActivity','FBRTCSupport','RTISession','createArrayFromMixed','errorCode','setIntervalAcrossTransitions','setTimeoutAcrossTransitions','WebStorage'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia){if(c.__markCompiled)c.__markCompiled();var ja=c('WebStorage').getSessionStorage(),ka='chproxy_base_sess',la,ma=t.create('channel'),na=null;function oa(eb){na=eb;}var pa={idle:{ok:'init!'},init:{ok:'pull!',error:'reconnect',sys_online:'init',sys_timetravel:'init'},pull:{ok:'pull!',error:'ping',error_missing:'pull',error_msg_type:'pull',refresh_0:'reconnect',refresh_110:'reconnect',refresh_111:'reconnect',refresh_112:'pull',refresh_113:'pull',refresh_117:'reconnect'},ping:{ok:'pull!',error:'ping',error_stale:'reconnect!'},reconnect:{ok:'init!',error:'reconnect',sys_online:'reconnect',sys_timetravel:'reconnect'},shutdown:{},_all:{error_max:'shutdown!',error_shutdown:'shutdown!',sys_owner:'reconnect',sys_nonowner:'idle!',sys_online:'ping',sys_offline:'idle!',sys_timetravel:'ping'}},qa={reconnectOverrideTimeMillis:Date.now(),userActive:Date.now(),created:Date.now(),ready:false,seqTurSentAt:-1,queueMade:'',lastPresenceState:null,lastRequestErrorReason:null,seq:0,estimatedReceived:0,fantail_logs:[],sessionID:(Math.random()*2147483648|0).toString(16),stableDeviceId:false,capabilities:da.getCapabilities(),streamingCapable:false,inStreaming:false,shouldSuppressPresence:x.shouldSuppress(),LONGPOLL_TIMEOUT:60000,STREAMING_TIMEOUT:60000,P_TIMEOUT:30000,IFRAME_LOAD_TIMEOUT:30000,MIN_RETRY_INTERVAL:5000,MAX_RETRY_INTERVAL:320000,MIN_12002_TIMEOUT:9000,MIN_504_TIMEOUT:20000,STALL_THRESHOLD:180000,JUMPSTART_THRESHOLD:90000,MIN_INIT_PROBE_DELAY:3000,INIT_PROBE_DELAY_RANDOMIZE_RANGE:12000,CHANNEL_PROXY_REPORTING_MIN_INTERVAL:10000,PROBE_DELAY:60000,PROBE_HEARTBEATS_INTERVAL_LOW:1000,PROBE_HEARTBEATS_INTERVAL_HIGH:5000,STREAMING_EXIT_STATE_ON_CONTINUE:false,FANTAIL_QUEUE_CAPACITY:50},ra={MAX_CONTINUOUS_PULL_FAILS:3,enabled:false,uptimeMillis:Date.now(),timeInGoodStatesStartMillis:Date.now(),timeInGoodStatesMillis:0,initialized:false,firstPullSentTimeMillis:Date.now(),accumulatedPullTimeMillis:0,pullStartTimeMillis:0,pingCount:0,pullCount:0,continuousPullFails:0,getTimeSinceFirstPullSentSeconds:function(){return (Date.now()-this.firstPullSentTimeMillis)/1000;},getUptimeSeconds:function(){return (Date.now()-this.uptimeMillis)/1000;},getAccumulatedPullTimeSeconds:function(){var eb=this.accumulatedPullTimeMillis,fb=Date.now();if(this.pullStartTimeMillis>0&&fb-this.pullStartTimeMillis<=qa.LONGPOLL_TIMEOUT)eb+=fb-this.pullStartTimeMillis;var gb=eb/1000;if(gb>=this.getTimeSinceFirstPullSentSeconds())this.initialize();return gb;},getPingToPullRatio:function(){return this.pullCount===0?0:this.pingCount/this.pullCount;},reportPullSent:function(){if(!this.enabled)return;if(!this.initialized)this.initialize();this.pullStartTimeMillis=Date.now();},initialize:function(){this.initialized=true;this.firstPullSentTimeMillis=Date.now();this.pullStartTimeMillis=0;this.accumulatedPullTimeMillis=0;this.pingCount=0;this.pullCount=0;this.timeInGoodStatesStartMillis=Date.now();this.timeInGoodStatesMillis=0;this.uptimeMillis=Date.now();},reportPullReturned:function(eb,fb){if(!this.enabled)return;if(this.pullStartTimeMillis>0){this.accumulatedPullTimeMillis+=Date.now()-this.pullStartTimeMillis;if(eb){this.pullCount++;this.continuousPullFails=0;}else this.continuousPullFails++;}this.pullStartTimeMillis=0;},reportPingSent:function(){if(!this.enabled)return;this.pingCount++;},isGoodState:function(eb){return eb.indexOf('pull')===0||eb.indexOf('init')===0||eb.indexOf('idle')===0;},getTotalTimeInGoodStatesSeconds:function(){var eb=this.timeInGoodStatesMillis;if(this.timeInGoodStatesStartMillis>0)eb+=Date.now()-this.timeInGoodStatesStartMillis;return eb/1000;},clientEnteredState:function(eb){if(!this.enabled)return;var fb=this.isGoodState(eb);if(fb&&this.timeInGoodStatesStartMillis===0){this.timeInGoodStatesStartMillis=Date.now();}else if(!fb&&this.timeInGoodStatesStartMillis>0){this.timeInGoodStatesMillis=Date.now()-this.timeInGoodStatesStartMillis;this.timeInGoodStatesStartMillis=0;}},transportEnteredState:function(eb){if(!this.enabled)return;if(eb.indexOf('pull')===0){this.reportPullSent();}else if(eb.indexOf('ping')===0&&qa.lastRequestErrorReason!==k.SYS_TIMETRAVEL&&qa.lastRequestErrorReason!==k.SYS_ONLINE&&qa.lastRequestErrorReason!==k.SYS_OWNER&&qa.lastRequestErrorReason!==k.SYS_NONOWNER)this.reportPingSent();},doSerialize:function(){if(!this.enabled)return '';return this.getTimeSinceFirstPullSentSeconds().toFixed(0)+','+this.getAccumulatedPullTimeSeconds().toFixed(0)+','+this.getPingToPullRatio().toFixed(3)+','+this.getUptimeSeconds().toFixed(0)+','+this.getTotalTimeInGoodStatesSeconds().toFixed(0);}},sa=1,ta={},ua=0;function va(){return j.lastSuccessTime?Math.round((Date.now()-j.lastSuccessTime)/1000):-1;}function wa(){var eb={};if(la.getConfig('host'))eb[la.getConfig('user_channel')]=la.getConfig('seq',0);return eb;}function xa(){var eb=Date.now(),fb=Date.now(),gb={total:0},hb='idle',ib=false;aa.subscribe([aa.USER,aa.ONLINE,aa.TIME_TRAVEL],function(lb,mb){za(true);fb=null;la.lastPullTime=Date.now();var nb;switch(lb){case aa.USER:nb=aa.isPageOwner()?k.SYS_OWNER:k.SYS_NONOWNER;break;case aa.ONLINE:nb=mb?k.SYS_ONLINE:k.SYS_OFFLINE;break;case aa.TIME_TRAVEL:nb=k.SYS_TIMETRAVEL;break;}la.exitState({status:nb,stateId:sa});});var jb=function(lb,mb){var nb=Date.now(),ob=null;if(mb){eb=nb;ob=mb.nextState||mb.state;}else ob=hb;aa.checkTimeTravel();if(fb){var pb=Math.round((nb-fb)/1000);if(pb>0){gb[hb]=(gb[hb]||0)+pb;gb.total+=pb;}}hb=ob;fb=nb;if(!lb){gb.lastSuccessTime=va();gb.online=aa.isOnline();ma.log('rollup',gb);}};i.subscribe(k.ON_ENTER_STATE,jb);ha(jb,60000);i.subscribe(t.DUMP_EVENT,function(lb,mb){mb.channelRollup=gb;});var kb=function(){if(la.isShutdown()||la.shouldIdle())return;aa.checkTimeTravel();var lb=Date.now()-(la.lastPullTime||q.start);if(!ib&&lb>qa.STALL_THRESHOLD){var mb=va();ma.error('stall',{lastSuccessTime:mb,rollupState:hb});ib=true;}var nb=Date.now()-eb;if(la.state=='pull'&&nb>qa.JUMPSTART_THRESHOLD){eb=null;ma.warn('jumpstart',{state:la.state,dormant:nb});la.enterState('init');}};ha(kb,10000);}function ya(){var eb=Date.now(),fb=1;function gb(){ia(gb,fb*1000);var lb=la.state;if(lb=='idle'&&la.shouldIdle())return;ma.bump('conn_t',fb);if(lb=='pull')ma.bump('conn_t_pull',fb);}gb();var hb=[15,30,60,120,240],ib=false,jb=false;function kb(lb){ia(function(){ma.rate('pullenter_'+lb,ib);ma.rate('pullexit_'+lb,jb);},lb*1000);}while(hb.length)kb(hb.shift());i.subscribe(k.ON_ENTER_STATE,function(lb,mb){if(mb.state=='pull')ib=true;eb=Date.now();});i.subscribe(k.ON_EXIT_STATE,function(lb,mb){if(mb.state!='pull'||!eb)return;var nb='other';if(mb.status==k.OK){jb=true;nb='ok';}else if(mb.xhr&&mb.xhr.errorType){nb=/ar:(\w+)/.test(mb.xhr.errorType)&&RegExp.$1;}else if(/^sys_/.test(mb.status))return;var ob=(Date.now()-eb)/1000;if(ob<0){return;}else if(ob>3600)ob=3600;ma.bump('conn_num');ma.bump('conn_exit',ob);ma.bump('conn_num_'+nb);ma.bump('conn_exit_'+nb,ob);});}function za(eb){if(eb){ua=0;ta={};}else ua++;}function ab(){if(!qa.stableDeviceId)return;var eb={},fb=function(gb){if(typeof qa[gb]=='string')eb[gb]=qa[gb];};fb('sticky_token');fb('sticky_pool');fb('host');fb('fullHost');ja.setItem(ka,JSON.stringify(eb));}function bb(){var eb=!h.supportsCORS()||qa.forceIframe;if(qa.subdomain===null||eb){qa.fullHost=qa.host;}else qa.fullHost=qa.subdomain+'-'+qa.host;ab();}function cb(eb){if(!eb)return false;eb=eb.trim();if(eb.length===0)return false;try{var gb=JSON.parse(eb),hb=function(ib){if(typeof gb[ib]=='string')qa[ib]=gb[ib];};hb('sticky_token');hb('sticky_pool');hb('host');hb('fullHost');return true;}catch(fb){ma.error('unable to parse state: '+eb);return false;}}la={state:'idle',nextState:null,proxyDown:false,lastPullTime:Date.now(),lastReportOnMisguidedMsgTime:Date.now(),heartbeats:[],setTestCallback:oa,backoff:false,sessionRegistered:false,init:function(eb){this.init=function(){};i.subscribe(k.GET_RTI_SESSION_REQUEST,(function(event,nb){this.informCurrentSession();}).bind(this));this._logFantail('client initialized',k.FANTAIL_INFO);var fb=!!qa.use_sticky_session,gb=false;qa.stableDeviceId=false;if(fb&&ja){qa.stableDeviceId=true;var hb=true;for(var ib=0;ib<ja.length;ib++){var jb=ja.key(ib);if(jb.indexOf(ka)===0){gb=cb(ja.getItem(jb));hb=!gb;break;}}if(hb)ab();}this._logFantail('using session id: '+qa.sessionID+(gb?' [restored]':' [new]')+' with sticky:'+qa.sticky_token+'/'+qa.sticky_pool,k.FANTAIL_INFO);ra.enabled=!!qa.watchdog_enabled;qa.watchdog=ra;if(typeof ca!='undefined'){ca.subscribe(function(){qa.userActive=Date.now();n.sendActivePing(qa);});}else ma.error('user_activity_undefined');w.register('ch',wa);var kb=this.getConfig('max_conn',2);qa.subdomain=m.allocate(kb);this._transportRate=new v(30000);var lb=h.supportsCORS()&&!qa.forceIframe?'CORSTransport':'IframeTransport';this.transport=new n[lb](this);if(eb)this.enterState.apply(this,arguments);i.subscribe(t.DUMP_EVENT,(function(event,nb){nb.transportRate=this._transportRate.tally();nb.transportType=lb;nb.transportVersion=2;}).bind(this));xa();ya();if(la.getConfig('tryStreaming')&&la.getConfig('host')&&h.supportsCORS()&&!qa.forceIframe){var mb=qa.MIN_INIT_PROBE_DELAY+Math.random()*qa.INIT_PROBE_DELAY_RANDOMIZE_RANGE;ia(this._probeTest,mb);}},configure:function(){var eb=fa(arguments);ma.log('configure',eb);eb.forEach(function(fb){return Object.assign(qa,fb);});bb();i.inform(k.ON_CONFIG,this);},getConfig:function(eb,fb){return eb in qa?qa[eb]:fb;},getCompleteConfig:function(){return qa;},informCurrentSession:function(){var eb=null;if(this.sessionRegistered&&qa&&qa.fullHost&&qa.sticky_token&&qa.uid)eb=new ea(qa.fullHost,qa.port,qa.sticky_pool,qa.sticky_token,qa.uid,qa.viewer_uid,qa.profile,qa.sessionID,qa.capabilities);i.inform(k.RTI_SESSION,eb);},getWatchdog:function(){return ra;},isShutdown:function(){return this.state=='shutdown';},shouldIdle:function(){return !(aa.isPageOwner()&&aa.isOnline());},_sendIframeError:function(eb){var fb=new j().setURI('/ajax/presence/reconnect.php').setData({reason:eb,fb_dtsg:p.getToken()}).setOption('suppressErrorHandlerWarning',true).setOption('retries',1).setMethod('GET').setReadOnly(true).setAllowCrossPageTransition(true);fb.specifiesWriteRequiredParams()&&fb.send();},_getDelay:function(){var eb=Math.min(qa.MIN_RETRY_INTERVAL*Math.pow(2,Math.max(0,ua-1)),qa.MAX_RETRY_INTERVAL);if(this.proxyDown&&'proxy_down_delay_millis' in qa)eb=qa.proxy_down_delay_millis;this.proxyDown=false;return Math.floor(eb*(1+Math.random()*.5));},enterState:function(){if(this._inEnterState)ma.warn('enterstate_recursion');this._inEnterState=true;try{this._enterState.apply(this,arguments);this._inEnterState=false;}catch(eb){this._inEnterState=false;throw eb;}},_enterState:function(eb){if((eb.indexOf('pull')===0||eb.indexOf('ping')===0||eb.indexOf('shutdown')===0)&&!!qa.active_config_refresh){var fb=Date.now(),gb=(fb-qa.reconnectOverrideTimeMillis)/1000;if('config_refresh_seconds' in qa&&qa.config_refresh_seconds>0&&gb>qa.config_refresh_seconds){eb='reconnect';this._logFantail('forcing reconnect to refresh config'+' - this is normal behavior',k.FANTAIL_DEBUG);}}if(eb.indexOf('reconnect')===0)qa.reconnectOverrideTimeMillis=Date.now();var hb=this.backoff?this._getDelay():0;this.backoff=false;var ib=fa(arguments);if(this.isShutdown()){this._logFantail('not executing state due to shutdown mode: '+eb,k.FANTAIL_WARN);return;}if(eb!='idle!'&&this.shouldIdle()){this._logFantail('forced idleness',k.FANTAIL_WARN);return;}sa++;qa.stateId=sa;clearTimeout(this._deferredTransition);this._deferredTransition=null;this.transport.enterState('idle');this.state='idle';this.nextState=null;if(/!$/.test(eb)){var jb=this._transportRate.tally().timeAverage,kb=la.getConfig('MAX_CHANNEL_STATES_PER_SEC',1);if(jb>=kb){if(!this._throttled){this._throttled=true;ma.warn('throttled');}ma.bump('throttle');hb=1000/kb;}}else if(!(/#$/.test(eb)))hb=this._getDelay();eb=eb.replace(/\W*$/,'');if(!pa[eb]){this._logFantail('invalid state: '+eb,k.FANTAIL_ERROR);throw new Error('invalid state:'+eb);}var lb;if(hb<=0){lb={state:eb};this._transportRate.add(1);this.state=eb;var mb=this['_enter_'+this.state];if(mb){ib.shift();mb.apply(this,ib);}if(/init|idle|pull|ping/.test(this.state)){if(qa.streamingCapable&&/pull/.test(this.state))this.heartbeats=[];ra.transportEnteredState(eb);ra.clientEnteredState(eb);qa.is_offline=!o.isOnline();qa.capabilities=da.getCapabilities();this._logFantail('entering transport state: '+this.state,k.FANTAIL_INFO);this.transport.enterState(this.state,qa);if(this.state=='ping'){lb.url=n.getURI(qa).toString();lb.port=qa.port||'undefined';}}}else{this.state='idle';this.nextState=eb;lb={state:this.state,delay:hb,nextState:eb};ib[0]=eb+'#';this._deferredTransition=ia((function(){this._deferredTransition=null;this.enterState.apply(this,ib);}).bind(this),hb);}if(/pull/.test(eb)){lb.client_id=qa.sessionID;lb.streaming=qa.inStreaming;}ma.log('enter_'+this.state,lb);i.inform(k.ON_ENTER_STATE,lb);},exitState:function(eb,fb){var gb=eb.stateId,hb=eb.status;if((hb==k.SYS_TIMETRAVEL||hb==k.SYS_ONLINE||hb==k.SYS_NONOWNER||hb==k.SYS_OWNER)&&ra)ra.initialize();if(this.isShutdown()||gb<sa)return;var ib=fa(arguments),jb=this.state;ib[0]=eb.status;var kb={state:jb,status:hb};if(/pull/.test(jb)){kb.client_id=qa.sessionID;kb.streaming=qa.inStreaming;}if(/ping/.test(jb)&&hb!=k.OK)kb.url=n.getURI(qa).toString();if(this.nextState)kb.nextState=this.nextState;if(fb&&fb.errorType){qa.lastRequestErrorReason=fb.errorType;kb.xhr=fb.toJSON?fb.toJSON():fb;if(fb.errorType==h.SERVICE_UNAVAILABLE){this._logFantail('got 5xx http status code, setting long delay',k.FANTAIL_ERROR);this.proxyDown=true;}delete kb.xhr.json;}else if(hb!=k.OK)qa.lastRequestErrorReason=hb;if(fb&&fb.json){if(fb.json.t)kb.t=fb.json.t;if(fb.json.reason)kb.reason=fb.json.reason;if(fb.json.seq)kb.seq=fb.json.seq;}ma.log('exit_'+jb,kb);i.inform(k.ON_EXIT_STATE,kb);var lb=this['_exit_'+jb];if(lb)hb=lb.apply(this,ib)||hb;if(hb!=k.OK){za();ta[jb]=(ta[jb]||0)+1;}var mb=pa[this.nextState||jb][hb]||pa._all[hb],nb=mb&&mb.replace(/!*$/,'');if(!nb){ma.error('terminal_transition',kb);this._shutdownHint=k.HINT_INVALID_STATE;mb='shutdown!';this._logFantail('entering shutdown state',k.FANTAIL_ERROR);}this._lastState=jb;this._lastStatus=hb;this.enterState(mb);},_processTransportData:function(eb,fb){var gb=fb.json,hb=gb.t;if('s' in gb){gb.seq=gb.s;delete gb.s;}if(gb.u&&qa.user&&gb.u!=qa.user){ma.warn('misguided_msg',{user:qa.user,target:gb.u});this._reportProxyMisguidedMsg(gb.u,qa.user);return;}var ib=qa.seq;if('seq' in gb){qa.seq=gb.seq;x.doSync();}switch(hb){case 'continue':if(qa.inStreaming&&this.heartbeats.length<1){qa.streamingCapable=false;ma.log('switch_to_longpoll');ia(this._probeTest,qa.PROBE_DELAY);}za(true);if(!qa.inStreaming||qa.STREAMING_EXIT_STATE_ON_CONTINUE)this.exitState({status:k.OK,stateId:eb});break;case 'refresh':case 'refreshDelay':this._logFantail('got refresh with reason: '+gb.reason,k.FANTAIL_INFO);this.exitState({status:'refresh_'+(gb.reason||0),stateId:eb},fb);break;case 'backoff':this._logFantail('server told client to back off',k.FANTAIL_WARN);za();this.backoff=true;break;case 'lb':var jb=gb.lb_info;if(jb){qa.sticky_token=jb.sticky;if('pool' in jb)qa.sticky_pool=jb.pool;if('vip' in jb)qa.host=jb.vip;bb();}else ma.error('bad lb info');break;case 'test_streaming':ia(this._probeTest,500);break;case 'fullReload':w.clear();ma.log('invalid_history');this.sessionRegistered=true;this.informCurrentSession();i.inform(k.ON_INVALID_HISTORY);za(true);this._logFantail('full reload incurred',k.FANTAIL_INFO);var kb=k.ERROR_MISSING;if(qa.fullReloadAsSuccess)kb=k.OK;this.exitState({status:kb,stateId:eb},fb);break;case 'msg':var lb,mb,nb,ob;za(true);if('tr' in gb)qa.trace_id=gb.tr;mb=gb.ms;nb=qa.seq-mb.length;for(lb=0;lb<mb.length;lb++,nb++){qa.estimatedReceived++;if(nb>=ib){ob=mb[lb];if(ob.type){var pb=k.getArbiterType(ob.type);if(ob.type==='messaging'){var qb={type:'messaging',event:ob.event};if(ob.message){qb.inbox_unread=ob.unread_counts&&ob.unread_counts.inbox;qb.tid=ob.message.tid;qb.mid=ob.message.mid;this._logFantail('got message with id: '+ob.message.mid,k.FANTAIL_INFO);}ma.debug('message',qb);}else if(ob.type==='pages_messaging'){if(ob.unread_counts&&ob.unread_counts.inbox)i.inform(k.getArbiterType('pages_inbox_count_update'),{page_id:ob[u.VIEWER_FBID],inbox_unread:ob.unread_counts.inbox});}else if(ob.type==='skywalker'){pb=k.SKYWALKER;}else if(ob.type==='qprimer'){ob.first=!qa.ready;if(ob.first){qa.ready=true;qa.timeUntilReady=Date.now()-qa.created;qa.queueMade=ob.made;}pb=k.CHANNEL_ESTABLISHED;}else ma.debug('message',{type:ob.type});i.inform(pb,{obj:ob});}}else ma.warn('seq_regression',{seq:nb,last_seq:ib,messages:mb.length});}break;case 'heartbeat':if(qa.inStreaming){var rb=Date.now();if(this.heartbeats.length>0){var sb=rb-this.heartbeats[this.heartbeats.length-1];ma.log('heartbeat_interval',{client_id:qa.sessionID,interval:sb});}this.heartbeats.push(rb);}break;default:this._logFantail('got an unknown protocol message: '+hb,k.FANTAIL_ERROR);ma.error('unknown_msg_type',{type:hb});break;}},_enter_init:function(){if(ta.init>=la.getConfig('MAX_INIT_FAILS',2))return setTimeout(this.exitState.bind(this,{status:k.ERROR_MAX,stateId:sa}),0);this._initTimer=ia(this.exitState.bind(this,{status:k.ERROR,stateId:sa},'timeout'),qa.IFRAME_LOAD_TIMEOUT);},_enter_reconnect:function(eb){this._logFantail('entered reconnect with reason: '+eb,k.FANTAIL_INFO);var fb=sa;if(!y.hasUserCookie()){this._logFantail('user has no cookie???',k.FANTAIL_WARN);ma.warn('no_user_cookie');setTimeout(function(){la._shutdownHint=k.HINT_AUTH;la.exitState({status:k.ERROR_SHUTDOWN,stateId:fb});},0);return;}var gb={reason:eb,fb_dtsg:p.getToken()};if(s.token)gb.fb_isb=s.token;if(na)na(gb);var hb=new r('GET','/ajax/presence/reconnect.php',gb);hb.onSuccess=(function(){la.configure(hb.json);w.store();this.exitState({status:k.OK,stateId:fb});}).bind(this);hb.onError=(function(){var ib=hb.json&&hb.json.error;this._logFantail('reconnect error: '+hb.errorType,k.FANTAIL_ERROR);if(hb.errorType==h.TRANSPORT_ERROR||hb.errorType==h.PROXY_ERROR||hb.errorType==h.SERVICE_UNAVAILABLE)this._shutdownHint=k.HINT_CONN;if(ib&&ib==1356007){this._shutdownHint=k.HINT_MAINT;}else if(ib==1357001||ib==1357004||ib==1348009){this._shutdownHint=k.HINT_AUTH;}else this._shutdownHint=null;this.exitState({status:this._shutdownHint?k.ERROR_SHUTDOWN:k.ERROR,stateId:fb},hb);}).bind(this);hb.send();},_enter_shutdown:function(){i.inform(k.ON_SHUTDOWN,{reason:this._shutdownHint});if(!!qa.shutdown_recovery_enabled&&'shutdown_recovery_interval_seconds' in qa&&qa.shutdown_recovery_interval_seconds>0){var eb=qa.shutdown_recovery_interval_seconds*1000;ia((function(){i.inform(k.ATTEMPT_RECONNECT);this.state='reconnect!';this.enterState('reconnect!');}).bind(this),eb);}},_exit_init:function(eb){if(this._initTimer)this._initTimer=clearTimeout(this._initTimer);if(eb==k.ERROR_MAX)this._sendIframeError(k.reason_IFrameLoadGiveUp);},_exit_pull:function(eb,fb){var gb=eb==k.OK;ra.reportPullReturned(gb,this);if(gb){this.lastPullTime=Date.now();}else{var hb='exit status: '+eb;if(fb&&fb.errorType)hb+=' ajax request error: '+fb.errorType;this._logFantail('pull failed with status: '+hb,k.FANTAIL_ERROR);}},_exit_ping:function(eb){if(eb==k.OK){var fb=Date.now()-(this.lastPullTime||q.start);if(fb>qa.STALL_THRESHOLD){this._logFantail('didnt complete a successful pull for too long',k.FANTAIL_ERROR);return k.ERROR_STALE;}}else this._logFantail('ping failed with status: '+eb,k.FANTAIL_ERROR);},_reportProxyMisguidedMsg:function(eb,fb){this._logFantail('misguided message to '+fb+' meant for '+eb,k.FANTAIL_ERROR);var gb=Date.now();if(gb-this.lastReportOnMisguidedMsgTime<=qa.CHANNEL_PROXY_REPORTING_MIN_INTERVAL)return;this.lastReportOnMisguidedMsgTime=gb;var hb={received_uid:eb,expected_uid:fb};if(qa.sticky_token)hb.sticky_token=qa.sticky_token;var ib=new ba('/err_misguided_msg').setDomain(qa.host+'.'+qa.domain).setPort(qa.port).setSecure(new ba(window.location.href).isSecure()).setQueryData(hb),jb=new h('GET',ib);if(h.supportsCORS())jb.xhr.withCredentials=true;jb.onSuccess=function(kb){};jb.onError=function(kb){};jb.onJSON=function(kb,lb){};jb.send();},_probeTest:function(){qa.streamingCapable=false;var eb=[],fb={mode:'stream',format:'json'};if(qa.sticky_token)fb.sticky_token=qa.sticky_token;var gb=new ba('/probe').setDomain(qa.host+'.'+qa.domain).setPort(qa.port).setSecure(new ba(window.location.href).isSecure()).setQueryData(fb),hb=new h('GET',gb);hb.onJSON=function(ib,jb){if(ib&&ib.json&&ib.json.t==='heartbeat'){eb.push(Date.now());if(eb.length>=2){var kb=eb[1]-eb[0];if(kb>=qa.PROBE_HEARTBEATS_INTERVAL_LOW&&kb<=qa.PROBE_HEARTBEATS_INTERVAL_HIGH){qa.streamingCapable=true;ma.log('switch_to_streaming');}ma.log('probe_ok',{time:kb});}}};hb.onSuccess=function(ib){if(eb.length!=2){qa.streamingCapable=false;ma.error('probe_error',{error:'beats.length = '+eb.length});}};hb.onError=function(ib){qa.streamingCapable=false;ma.error('probe_error',ib);};ma.log('probe_request');hb.send();},_logFantail:function(eb,fb){var gb=qa.fantail_queue_capacity||qa.FANTAIL_QUEUE_CAPACITY;if(!qa.fantail_enabled||qa.fantail_logs.length>gb)return;var hb='fantail queue size exceeded',ib=k.FANTAIL_WARN;if(qa.fantail_logs.length<gb){hb=eb;ib=fb;}var jb=qa.fantail_logs.length,kb={};kb['time'+jb]=Date.now();kb['log'+jb]=hb;kb['severity'+jb]=ib;qa.fantail_logs.push(kb);}};f.exports=la;function db(){if(l.channelConfig){la.configure(l.channelConfig);if(/shutdown/.test(l.state))la._shutdownHint=k[l.reason];la.init(l.state,l.reason);}}z.onAfterLoad(db);},null);
__d('ChannelConnection',['Arbiter','Run','SystemEvents','ChannelConstants','ChannelManager','JSLogger','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();var o=m.create('channel_connection'),p=null,q=null,r=null,s=null,t=0,u=Object.assign(new h(),{CONNECTED:'chat-connection/connected',RECONNECTING:'chat-connection/reconnecting',SHUTDOWN:'chat-connection/shutdown',MUTE_WARNING:'chat-connection/mute',UNMUTE_WARNING:'chat-connection/unmute'});i.onBeforeUnload(function(){});function v(){if(q){clearTimeout(q);q=null;}}function w(){v();o.log('unmute_warning');u.inform(u.UNMUTE_WARNING);}function x(ca){v();q=n(w,ca);o.log('mute_warning',{time:ca});u.inform(u.MUTE_WARNING);}function y(){if(r){clearTimeout(r);r=null;}}function z(ca,da){y();if(ca===k.ON_ENTER_STATE&&(da.nextState||da.state)==='pull'){if(s!==u.CONNECTED){o.log('connected');var ea=!s;s=u.CONNECTED;t=0;u.inform(u.CONNECTED,{init:ea});}}else if(ca===k.ON_ENTER_STATE&&((da.nextState||da.state)==='ping'||!da.nextState&&da.state==='idle')){r=n(function(){var fa=null;if(!(da.state==='idle'&&!da.nextState))fa=da.delay||0;o.log('reconnecting',{delay:fa});if(u.disconnected())o.log('reconnecting_ui',{delay:fa});s=u.RECONNECTING;da.state==='idle'&&t++;if(t>1){u.inform(u.RECONNECTING,fa);}else if(!da.nextState&&da.state==='idle')z(ca,da);},500);}else if(ca===k.ON_SHUTDOWN){o.log('shutdown',{reason:da.reason});s=u.SHUTDOWN;t=0;u.inform(u.SHUTDOWN,da.reason);}}function aa(){if(l.isShutdown()){z(k.ON_SHUTDOWN,l._shutdownHint);}else z(k.ON_ENTER_STATE,{state:l.state,nextState:l.nextState,delay:0});}i.onAfterLoad(aa);Object.assign(u,{disconnected:function(){return s===u.SHUTDOWN||s===u.RECONNECTING&&!q&&t>1;},isShutdown:function(){return s===u.SHUTDOWN;},reconnect:function(ca){if(l.state==='ping'||l.isShutdown())return;o.log('reconnect',{now:ca});u.inform(u.RECONNECTING,0);if(!!ca){if(p!==null){clearTimeout(p);p=null;}l.enterState('ping!');}else if(!p)p=n(function(){l.enterState('ping!');p=null;},k.CHANNEL_MANUAL_RECONNECT_DEFER_MSEC);},unmuteWarning:w});function ba(){h.subscribe([k.ON_ENTER_STATE,k.ON_SHUTDOWN],z);h.subscribe(k.ATTEMPT_RECONNECT,function(){if(u.disconnected())u.reconnect();});j.subscribe(j.TIME_TRAVEL,function(){u.reconnect();x(k.MUTE_WARNING_TIME_MSEC);});i.onBeforeUnload(y,false);}i.onAfterLoad(ba);u.mockAfterLoad=function(){aa();ba();};f.exports=u;},null);
__d('ChatproxyLastMobileActiveTimes',['ServerTime','fbt'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j={};function k(o){if(!o||o<0)return '';var p=h.get()/1000-o,q=Math.floor(p/60),r=Math.floor(q/60),s=Math.floor(r/24);if(q<=1){return i._("{count}m",[i.param('count',1)]);}else if(q<60){return i._("{count}m",[i.param('count',q)]);}else if(r<24){return i._("{count}h",[i.param('count',r)]);}else if(s<3){return i._("{count}d",[i.param('count',s)]);}else return '';}function l(o,p){if(!(o in j)||j[o]<p)j[o]=p;}function m(o){if(o in j){return j[o];}else return 0;}var n={update:function(o){for(var p in o)l(p,o[p]);},getShortDisplay:function(o){return k(m(o));},get:function(o){return m(o);},getDebugData:function(){return j;}};f.exports=n;},null);
__d('ChatproxyPresenceStatus',['ArbiterMixin','AvailableListConstants','BanzaiODS','ChatVisibility','CurrentUser','ChatproxyLastMobileActiveTimes','LogHistory','PresencePrivacy','ServerTime','createObjectFrom','debounceAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){if(c.__markCompiled)c.__markCompiled();j.setEntitySample('presence',.0001);var s=n.getInstance('presence_status'),t={},u={},v={},w={},x={},y={},z={},aa=Object.assign({},h),ba=r(function(){return aa.inform('change');},0);Object.assign(aa,{resetPresenceData:function(){u={};v={};z={};y={};x={};},reset:function(){aa.resetPresenceData();w={};},get:function(ca){if(ca==l.getID())return k.isOnline()?i.ACTIVE:i.OFFLINE;var da=i.OFFLINE;if(ca in u)da=u[ca];if(da===i.OFFLINE||da===i.IDLE)if(w[ca])da=i.MOBILE;if(!o.allows(ca))da=i.OFFLINE;return da;},getCapabilities:function(ca){var da=aa.get(ca);if(da==i.OFFLINE)return 0;var ea=v[ca];return ea?ea:0;},getDetailedActivePresence:function(ca){var da=z[ca];if(!da)return i.ACTIVE_ON_WEB;var ea=this._getDetailedActivePresenceFromObject(da);if(ea)return ea;if(!t[ca]){s.error('inconsistent_presence',{id:ca,presence:aa.getDebugInfo(ca)});j.bumpEntityKey('presence','inconsistent_presence');t[ca]=true;}return null;},_getDetailedActivePresenceFromObject:function(ca){var da=ca[i.WEB_STATUS],ea=ca[i.FB_APP_STATUS],fa=ca[i.MESSENGER_STATUS],ga=ca[i.OTHER_STATUS];if(ea===i.STATUS_ACTIVE||fa===i.STATUS_ACTIVE){return i.ACTIVE_ON_MOBILE;}else if(da===i.STATUS_ACTIVE||ga===i.STATUS_ACTIVE)return i.ACTIVE_ON_WEB;},isMessengerUser:function(ca){var da=z[ca];if(da)if(da[i.MESSENGER_STATUS]==i.STATUS_ACTIVE)return true;return w[ca];},hasDetailedPresenceData:function(ca){return z[ca]!=null;},getGroup:function(ca){return ca.some(function(da){if(da==l.getID())return false;return aa.get(da)===i.ACTIVE;})?i.ACTIVE:i.OFFLINE;},set:function(ca,da,ea,fa,ga,ha){if(ca==l.getID())return false;switch(da){case i.OFFLINE:case i.IDLE:case i.ACTIVE:case i.MOBILE:break;default:return false;}var ia=aa.get(ca),ja=ia!=da;if(ja&&ia==i.ACTIVE||da==i.ACTIVE){var ka={};ka[ca]=p.get()/1000;m.update(ka);}var la=false;if(!ja&&ga)la=aa.getCapabilities(ca)!=ga;if(ea){x[ca]=p.get();y[ca]=fa;}u[ca]=da;if(ga)v[ca]=ga;if(ha)z[ca]=ha;var ma=ja||la;if(ma)ba();return ma;},setMobileFriends:function(ca){w=q(ca);},getOnlineIDs:function(){var ca,da=[];for(ca in u)if(aa.get(ca)===i.ACTIVE)da.push(ca);return da;},getAvailableIDs:function(){var ca=aa.getOnlineIDs(),da;for(da in w){if(u[da])continue;ca.push(da);}return ca;},getOnlineCount:function(){return aa.getOnlineIDs().length;},getPresenceStats:function(){var ca=0,da=0,ea=0,fa=0,ga=0;for(var ha in u){ca+=1;switch(aa.get(ha)){case i.OFFLINE:da+=1;break;case i.IDLE:ea+=1;break;case i.ACTIVE:fa+=1;break;case i.MOBILE:ga+=1;break;default:break;}}return {total:ca,offline:da,idle:ea,active:fa,mobile:ga};},getDebugInfo:function(ca){return {id:ca,presence:u[ca],detailedPresence:z[ca],overlaySource:y[ca],overlayTime:x[ca],mobile:w[ca]};},getAllDebugInfo:function(){return {presence:u,detailedPresence:z,overlaySource:y,overlayTime:x,mobile:w};}});f.exports=aa;},null);
__d('ComparePresence',['ChatproxyPresenceStatus','PresenceStatus','LastMobileActiveTimes','ChatproxyLastMobileActiveTimes','BanzaiODS'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m={compareCpWithPp:function(){var n=i.getAllDebugInfo(),o=h.getAllDebugInfo(),p=0,q=0,r=0;for(var s in o.presence){if(n.presence[s]!==o.presence[s]&&o.presence[s]!==0){p++;l.bumpEntityKey('diff_presence_data','diff');}else l.bumpEntityKey('diff_presence_data','same');if(i.getDetailedActivePresence(s)!==h.getDetailedActivePresence(s)){q++;l.bumpEntityKey('diff_detailed_presence_data','diff');}else l.bumpEntityKey('diff_detailed_presence_data','same');if(i.getCapabilities(s)!==h.getCapabilities(s)){r++;l.bumpEntityKey('diff_capability','diff');}else l.bumpEntityKey('diff_capability','same');}this._compareLastActiveTime();},_compareLastActiveTime:function(){var n=j.getDebugData(),o=k.getDebugData(),p=0,q=0,r=0;for(var s in o)if(s in n){var t=Math.abs(o[s]-n[s]);p+=t;q++;var u=o[s]-n[s];r+=u;if(t>60){l.bumpEntityKey('diff_last_active_time','diff');}else l.bumpEntityKey('diff_last_active_time','same');}else l.bumpEntityKey('diff_last_active_time','diff');l.bumpEntityKey('diff_last_active_time','sum_diff',p);l.bumpEntityKey('diff_last_active_time','sum_diff_cp_pp',r);l.bumpEntityKey('diff_last_active_time','num_of_id',q);l.bumpEntityKey('diff_last_active_time','num_of_push');}};f.exports=m;},null);
__d('ChatproxyPresence',['Arbiter','AvailableListConstants','ChannelConstants','ChatproxyPresenceStatus','ChatproxyLastMobileActiveTimes','CurrentUser','ComparePresence','AvailableListInitialData','PresenceStatus','LastMobileActiveTimes'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){if(c.__markCompiled)c.__markCompiled();function r(s){'use strict';this.$ChatproxyPresence1=s;}r.prototype.subscribe=function(){'use strict';h.subscribe(j.getArbiterType('chatproxy-presence'),this.updatePresenceInfo.bind(this));};r.prototype.updatePresenceInfo=function(s,t){'use strict';k.resetPresenceData();var u={};t=t.obj;var v=t.buddyList;for(var w in v){if(w===m.getID()||w==='type')continue;var x=0;switch(v[w].p){case 0:x=i.OFFLINE;break;case 1:x=i.ACTIVE;break;case 2:x=i.IDLE;}var y=0;if(v[w].vc)y=v[w].vc;var z=null;if(v[w].dcp)z=this.updateDetailedPresence(v[w].dcp);if(v[w].lat)u[w]=v[w].lat;if(x!==undefined||y!==undefined&&z!==undefined){if(o.gk_replace_available_list_chatproxy)p.set(w,x,false,'chatproxy',y,z);k.set(w,x,false,'chatproxy',y,z);}}if(o.gk_replace_available_list_chatproxy){q.update(u);if(!!t.mobileFriends)p.setMobileFriends(t.mobileFriends);this.$ChatproxyPresence1(i.ON_CHAT_NOTIFICATION_CHANGED,this.$ChatproxyPresence2);}l.update(u);if(!!t.mobileFriends)k.setMobileFriends(t.mobileFriends);n.compareCpWithPp();};r.prototype.getIsUserIdle=function(){'use strict';return this.$ChatproxyPresence3;};r.prototype.getWebChatNotification=function(){'use strict';return this.$ChatproxyPresence2;};r.prototype.updateDetailedPresence=function(s){'use strict';var t={};if((s&8)!==0){t[i.MESSENGER_STATUS]=i.STATUS_ACTIVE;}else t[i.MESSENGER_STATUS]=i.STATUS_OFFLINE;if((s&4)!==0){t[i.FB_APP_STATUS]=i.STATUS_ACTIVE;}else t[i.FB_APP_STATUS]=i.STATUS_OFFLINE;if((s&2)!==0){t[i.WEB_STATUS]=i.STATUS_ACTIVE;}else t[i.WEB_STATUS]=i.STATUS_OFFLINE;if((s&1)!==0){t[i.OTHER_STATUS]=i.STATUS_ACTIVE;}else t[i.OTHER_STATUS]=i.STATUS_OFFLINE;return t;};f.exports=r;},null);
__d('ChatContexts',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={};function i(l){var m=l?l.subtext:'';return m;}function j(l,m){h[l]=m;}var k={get:function(l){if(l in h){return h[l];}else return null;},update:function(l){for(var m in l)j(m,l[m]);},getShortDisplay:function(l){return i(k.get(l));}};f.exports=k;},null);
__d('PresencePoller',['AvailableListConstants','AvailableListInitialData','BanzaiODS','ChannelConnection','ChatContexts','ChatVisibility','CurrentUser','JSLogger','LastMobileActiveTimes','Poller','PresencePrivacy','PresenceStatus','ServerTime','ShortProfiles','UserActivity','debounceAcrossTransitions','errorCode'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){if(c.__markCompiled)c.__markCompiled();var y=5,z='/ajax/chat/buddy_list.php',aa=1800000,ba=i.pollInterval,ca=i.lazyPollInterval,da=i.lazyThreshold,ea=o.create('available_list'),fa='presence_poller';j.setEntitySample(fa,.01);function ga(ha){'use strict';this.$PresencePoller1=ha;this.$PresencePoller2=false;this.$PresencePoller3=i.chatNotif;this.$PresencePoller4=false;this.$PresencePoller5=[];this.$PresencePoller6=new q({interval:ba,setupRequest:this.$PresencePoller7.bind(this),clearOnQuicklingEvents:false,dontStart:true});if(m.isOnline()){this.$PresencePoller8=Date.now();this.$PresencePoller9=Date.now();this.$PresencePoller10=Date.now();this.$PresencePoller11=i.updateTime;}else{this.$PresencePoller8=0;this.$PresencePoller11=0;this.$PresencePoller9=0;this.$PresencePoller10=0;}this.$PresencePoller12=0;this.$PresencePoller13('available_initial_data',i.updateTime,i.availableList,i.lastActiveTimes,i.mobileFriends,i.perpetuallyMobileBuddies);v.subscribe((function(ia,ja){if(ja.idleness>ba)this.forceUpdate();}).bind(this));r.subscribe('privacy-user-presence-changed',(function(){this.forceUpdate();}).bind(this));}ga.prototype.start=function(){'use strict';setTimeout(this.$PresencePoller6.start.bind(this.$PresencePoller6),0);};ga.prototype.restart=function(){'use strict';if(this.$PresencePoller6.isMuted()){this.$PresencePoller6.resume();this.forceUpdate();}};ga.prototype.stop=function(){'use strict';this.$PresencePoller6.mute();};ga.prototype.forceUpdate=function(){'use strict';this.$PresencePoller4=true;this.$PresencePoller6.request();};ga.prototype.getIsUserIdle=function(){'use strict';return this.$PresencePoller2;};ga.prototype.getWebChatNotification=function(){'use strict';return this.$PresencePoller3;};ga.prototype.getCallback=function(){'use strict';return this.$PresencePoller1;};ga.prototype.addExtraBuddy=function(ha){'use strict';if(this.$PresencePoller5.indexOf(ha)!==-1)return;this.$PresencePoller5.push(ha);};ga.prototype.$PresencePoller14=function(){'use strict';return w((function(){this.$PresencePoller1(h.ON_AVAILABILITY_CHANGED);}).bind(this),0)();};ga.prototype.$PresencePoller13=function(ha,ia,ja,ka,la,ma){'use strict';this.$PresencePoller11=ia;if(!i.gk_replace_available_list_chatproxy||Object.keys(ja).length!=0)if(!Array.isArray(ja)){s.resetPresenceData();for(var na in ja)s.set(na,ja[na].a,false,ha,ja[na].c,ja[na].p);}if(ka&&!Array.isArray(ka))p.update(ka);if(la)s.setMobileFriends(la);if(ma)s.setPerpetuallyMobileBuddies(ma);this.$PresencePoller14();};ga.prototype.$PresencePoller7=function(ha){'use strict';if(k.isShutdown()||!m.isOnline()){this.$PresencePoller6.skip();j.bumpEntityKey(fa,'skip.offline');return;}if(Date.now()-this.$PresencePoller8<ba){this.$PresencePoller6.skip();j.bumpEntityKey(fa,'skip.recent');return;}j.bumpEntityKey(fa,'request');this.$PresencePoller8=Date.now();var ia=Date.now()-this.$PresencePoller10,ja=u.getCachedProfileIDs().join(","),ka=true;if(i.gk_replace_available_list_chatproxy&&!this.$PresencePoller4&&this.$PresencePoller5.length===0)ka=false;this.$PresencePoller4=false;ha.setHandler(this.$PresencePoller15.bind(this)).setErrorHandler(this.$PresencePoller16.bind(this)).setOption('suppressErrorAlerts',true).setOption('retries',1).setData({user:n.getID(),cached_user_info_ids:ja,fetch_mobile:ia>aa,additional_buddies:this.$PresencePoller5,get_now_available_list:ka}).setURI(z).setAllowCrossPageTransition(true);};ga.prototype.$PresencePoller15=function(ha){'use strict';var ia=ha.getPayload(),ja=ia.buddy_list;if(!ja){this.$PresencePoller16(ha);return;}j.bumpEntityKey(fa,'response');this.$PresencePoller17();this.$PresencePoller9=Date.now();t.update(ia.time);if(ja.mobile_friends)this.$PresencePoller10=Date.now();this.$PresencePoller12=0;this.$PresencePoller18();var ka=ja.userInfos;if(ka)u.setMulti(ka);var la=ja.chatContexts;la&&l.update(la);this.$PresencePoller2=ja.userIsIdle;if(ja.chatNotif!==undefined&&ja.chatNotif!==this.$PresencePoller3){this.$PresencePoller3=ja.chatNotif;this.$PresencePoller1(h.ON_CHAT_NOTIFICATION_CHANGED,this.$PresencePoller3);}this.$PresencePoller13('buddy_list_poller',ia.time,ja.nowAvailableList,ja.last_active_times,ja.mobile_friends,ja.perpetually_mobile_buddies);};ga.prototype.$PresencePoller16=function(ha){'use strict';j.bumpEntityKey(fa,'error');if(ha.getError()==1356007)return;this.$PresencePoller12++;if(this.$PresencePoller12>=y)this.$PresencePoller1(h.ON_UPDATE_ERROR);};ga.prototype.$PresencePoller18=function(){'use strict';var ha=v.isActive(da)?ba:ca;j.bumpEntityKey(fa,'period.'+ha);this.$PresencePoller6.setInterval(ha);};ga.prototype.$PresencePoller17=function(){'use strict';var ha=Date.now(),ia=ha-this.$PresencePoller9;ea.log('buddylist_presence_stats',babelHelpers._extends({duration:ia},s.getPresenceStats()));};f.exports=ga;},null);
__d("TypingStates",[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={INACTIVE:0,TYPING:1,QUITTING:2};f.exports=h;},null);
__d('AvailableList',['Arbiter','ArbiterMixin','AsyncRequest','AvailableListConstants','BanzaiODS','ChannelConnection','ChannelConstants','ChatConfig','ChatVisibility','ErrorUtils','JSLogger','LastMobileActiveTimes','PresencePoller','PresencePrivacy','PresenceStatus','ServerTime','ShortProfiles','TypingStates','debounceAcrossTransitions','emptyFunction','AvailableListInitialData','ChatproxyPresence','ChatproxyPresenceStatus','ChatproxyLastMobileActiveTimes','ChannelTransport','ChannelManager'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga){'use strict';if(c.__markCompiled)c.__markCompiled();l.setEntitySample('presence',.0001);var ha=babelHelpers._extends({},k,i);ha.subscribe([k.ON_AVAILABILITY_CHANGED,k.ON_UPDATE_ERROR],function(sa,ta){h.inform(sa,ta);});var ia=z(function(){return ha.inform(k.ON_AVAILABILITY_CHANGED);},0);function ja(sa,ta,ua,va,wa,xa){var ya=v.set(sa,ta,ua,va,wa,xa);da.set(sa,ta,ua,va,wa,xa);if(ya){var za=z(function(){return ha.inform(k.ON_AVAILABILITY_CHANGED,sa);},0);za();}}function ka(sa){var ta=sa.payload.availability||{};for(var ua in ta)ja(ua&&ua.toString(),ta[ua].a,true,'mercury_tabs',ta[ua].c,ta[ua].p);}function la(){if(!ba.gk_replace_available_list_chatproxy)pa&&pa.restart();}function ma(){if(!ba.gk_replace_available_list_chatproxy)pa&&pa.stop();}function na(sa){var ta=ha.getDebugInfo(sa),ua=ta.presence==k.ACTIVE;new j('/ajax/mercury/tabs_presence.php').setData({target_id:sa,to_online:ua,presence_source:ta.overlaySource,presence_time:ta.overlayTime}).setHandler(ka).setErrorHandler(aa).setAllowCrossPageTransition(true).send();}function oa(sa,ta){ta.chat_config=o.getDebugInfo();ta.available_list_debug_info={};v.getAvailableIDs().forEach(function(ua){ta.available_list_debug_info[ua]=ha.getDebugInfo(ua);});ta.available_list_poll_interval=ha._poller&&ha._poller.getInterval();}var pa;if(!ba.gk_replace_available_list_chatproxy)try{pa=new t(function(event){ha.inform(event);});}catch(qa){q.reportError&&q.reportError(qa,false);}var ra;try{ra=new ca(function(event){ha.inform(event);});}catch(qa){q.reportError&&q.reportError(qa,false);}ra&&ra.subscribe();Object.assign(ha,{get:function(sa){return v.get(sa);},updateForID:function(sa){na(sa);if(!ba.gk_replace_available_list_chatproxy){pa&&pa.addExtraBuddy(sa);}else if(u.getVisibility()==u.ONLINE)fa.sendAdditionalBuddyRequest(ga.getCompleteConfig(),sa);},getWebChatNotification:function(){if(!ba.gk_replace_available_list_chatproxy)return pa&&pa.getWebChatNotification&&pa.getWebChatNotification();},isUserIdle:function(){if(!ba.gk_replace_available_list_chatproxy)return pa&&pa.getIsUserIdle();},isReady:function(){if(!ba.gk_replace_available_list_chatproxy)return !!pa;return !!ra;},set:function(sa,ta,ua,va,wa){ja(sa,ta,true,ua,va,wa);},update:function(){if(!ba.gk_replace_available_list_chatproxy)pa&&pa.forceUpdate();},isIdle:function(sa){return ha.get(sa)==k.IDLE;},getDebugInfo:function(sa){var ta=v.getDebugInfo(sa),ua=x.getNow(sa);if(ua)ta.name=ua.name;return ta;}});if(!ba.gk_replace_available_list_chatproxy)pa&&pa.start();h.subscribe(r.DUMP_EVENT,oa);h.subscribe('chat-visibility/go-online',la);h.subscribe('chat-visibility/go-offline',ma);u.subscribe(['privacy-changed','privacy-availability-changed','privacy-user-presence-response'],ia);m.subscribe([m.CONNECTED,m.RECONNECTING,m.SHUTDOWN,m.MUTE_WARNING,m.UNMUTE_WARNING],ia);h.subscribe(n.getArbiterType('buddylist_overlay'),function(sa,ta){var ua={},va=ta.obj.overlay;for(var wa in va){ha.set(wa,va[wa].a,va[wa].s||'channel',va[wa].vc,va[wa].p);if(va[wa].la)ua[wa]=va[wa].la;}s.update(ua);ea.update(ua);});h.subscribe([n.getArbiterType('typ'),n.getArbiterType('ttyp')],function(sa,ta){var ua=ta.obj;if(ua.st===y.TYPING){var va=ua.from;if(p.isOnline()){l.bumpEntityKey('presence','stale_presence_check_typing');var wa=v.get(va);if(wa!=k.ACTIVE){var xa=s.get(va)*1000,ya=w.get();if(!xa){l.bumpEntityKey('presence','no_detailed_presence_typing');}else if(ya-xa>5*60*1000){var za='stale_presence_typing',ab=ya-xa;if(ab<10*60*1000){za+='600';}else if(ab<60*60*1000)za+='3600';l.bumpEntityKey('presence',za);}}}ha.set(va&&va.toString(),k.ACTIVE,'channel-typing');}});h.subscribe(n.getArbiterType('messaging'),function(sa,ta){if(!p.isOnline())return;var ua=ta.obj;if(ua.message&&ua.message.timestamp&&ua.message.sender_fbid){var va=w.get(),wa=ua.message.timestamp;if(va-wa<2*60*1000){l.bumpEntityKey('presence','stale_presence_check');var xa=ua.message.sender_fbid,ya=v.get(xa);if(ya==k.ACTIVE)return;var za=s.get(xa)*1000;if(!za){l.bumpEntityKey('presence','no_detailed_presence');}else if(wa-za>5*60*1000){var ab='stale_presence',bb=wa-za;if(bb<10*60*1000){ab+='600';}else if(bb<60*60*1000)ab+='3600';l.bumpEntityKey('presence',ab);}}}});b.AvailableList=f.exports=ha;},null);
__d('FavIcon',['DOM'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i,j,k;function l(){var n=h.scry(document.head,"link");if(n)n.forEach(function(o){if(o.rel.indexOf('icon')!=-1||o.rel.indexOf('shortcut icon')!=-1)h.remove(o);});}var m={isToggledResource:function(){if(k&&i.href===k)return true;return false;},set:function(n){if(i)h.remove(i);l();i=h.create('link',{type:'image/x-icon',rel:'icon',href:n});h.appendContent(h.find(document,'head'),i);},setToggleResources:function(n,o){i=document.querySelector('link[rel*=icon][href*=".ico"]');if(!i)return;j=o||i.href;k=n;},toggle:function(){if(!i||!k)return;if(i.href===j){this.set(k);return;}this.set(j);}};f.exports=m;},null);`h^T      VKVK;uW   Ba,:https://fbstatic-a.akamaihd.net/rsrc.php/v2/yd/r/VjiWjjTjzFq.js necko:classified 1 security-info FnhllAKWRHGAlo+ESXykKAAAAAAAAAAAwAAAAAAAAEaphjojH6pBabDSgSnsfLHeAAQAAgAAAAAAAAAAAAAAAAAAAAAB4vFIJp5wRkeyPxAQ9RJGKPqbqVvKO0mKuIl8ec8o/uhmCjImkVxP+7sgiYWmMt8F+O2DZM7ZTG6GukivU8OT5gAAAAAAAAXAMIIFvDCCBKSgAwIBAgIUPbXhC4Xsu7H3z2HTJ2qImwWmfEMwDQYJKoZIhvcNAQELBQAwgY0xCzAJBgNVBAYTAk5MMRIwEAYDVQQHEwlBbXN0ZXJkYW0xJTAjBgNVBAoTHFZlcml6b24gRW50ZXJwcmlzZSBTb2x1dGlvbnMxEzARBgNVBAsTCkN5YmVydHJ1c3QxLjAsBgNVBAMTJVZlcml6b24gQWthbWFpIFN1cmVTZXJ2ZXIgQ0EgRzE0LVNIQTIwHhcNMTUwODI3MTYxMDEyWhcNMTYwODI3MTYxMDExWjBtMQswCQYDVQQGEwJVUzELMAkGA1UECBMCTUExEjAQBgNVBAcTCUNhbWJyaWRnZTEhMB8GA1UEChMYQWthbWFpIFRlY2hub2xvZ2llcyBJbmMuMRowGAYDVQQDExFhMjQ4LmUuYWthbWFpLm5ldDCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMEsC1Bf+D5X49PrJxQQynzSoPaTqlm/R6G6xlDErWOJauViiexo6vmzahzzSlMEPVYpyT5oRd3SB4Qx7548TyiC90yse+aFur0qrNLeNMG7npVWA0up2v4a8msqYRACxoHcLolFXNFPNWtBTsRW42Ce+pg94pP4gWvBeFVclt3v9x2mr8RHafRNVLJvAJi+eg2mZlfeccqCWrIXKp/xZGUWBswTK+TFC2s1pJNxQkDMYpmLdgte0H0h4IRh8V7elj7TP/8Z8i0l4SxIHNbuqA8HvjBsundiNujlykBR9JSvX238ATPLOFrqkQQz6UAYHo2RRH7X72Uvbitu38jPYVcCAwEAAaOCAjEwggItMAwGA1UdEwEB/wQCMAAwTAYDVR0gBEUwQzBBBgkrBgEEAbE+ATIwNDAyBggrBgEFBQcCARYmaHR0cHM6Ly9zZWN1cmUub21uaXJvb3QuY29tL3JlcG9zaXRvcnkwga8GCCsGAQUFBwEBBIGiMIGfMC0GCCsGAQUFBzABhiFodHRwOi8vdmFzc2cxNDIub2NzcC5vbW5pcm9vdC5jb20wNgYIKwYBBQUHMAKGKmh0dHBzOi8vY2FjZXJ0LmEub21uaXJvb3QuY29tL3Zhc3NnMTQyLmNydDA2BggrBgEFBQcwAoYqaHR0cHM6Ly9jYWNlcnQuYS5vbW5pcm9vdC5jb20vdmFzc2cxNDIuZGVyMG4GA1UdEQRnMGWCEWEyNDguZS5ha2FtYWkubmV0gg4qLmFrYW1haWhkLm5ldIIWKi5ha2FtYWloZC1zdGFnaW5nLm5ldIIPKi5ha2FtYWl6ZWQubmV0ghcqLmFrYW1haXplZC1zdGFnaW5nLm5ldDAOBgNVHQ8BAf8EBAMCBaAwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMCMB8GA1UdIwQYMBaAFPi9+q9zd8bHG/lLTRGn0TOvr3IRMD4GA1UdHwQ3MDUwM6AxoC+GLWh0dHA6Ly92YXNzZzE0Mi5jcmwub21uaXJvb3QuY29tL3Zhc3NnMTQyLmNybDAdBgNVHQ4EFgQUwHfR+EVeIyYOCfrHIM4gYFwsUd8wDQYJKoZIhvcNAQELBQADggEBALu54DWULbb7PuC5sYITWHJAFLikko7suU7mUu2a/QvS/GNNHfm4ny+on2w++/itYAKrsNMXkX1zglqtX6AACSUlgw7K6G7CoEVJXBntkBmt9wAJXroe2jMgWYvpbmYkcyaNRc4VvOK9FjvHslqXa5Y6NArfI5kRfdljblFQXR2sTYyYk0Dqqq8COCs62GhyLlP/oohQU0hA6EtomF5VFNlokO9qa+IAHrp2lR/+BLYcwPgOCxszCZikcmP5zyAnkte1Blh9kBQnKf6J6wTZsUUPcLktNr7FFqRIay8moKUuxYiSqlE4kSktcYqXy5cGrgYfwGYM93+0O3y8QZ30vLHALwADAAAAAAEBAAA= request-method GET response-head HTTP/1.1 200 OK
access-control-allow-origin: *
Cache-Control: public, max-age=30347320
Content-MD5: e/1sVvtTOCumHsa3GMkv0A==
Content-Type: application/x-javascript; charset=utf-8
Date: Thu, 15 Oct 2015 15:55:15 GMT
Expires: Fri, 30 Sep 2016 21:43:55 GMT
Last-Modified: Mon, 01 Jan 2001 08:00:00 GMT
Timing-Allow-Origin: *
x-content-type-options: nosniff
X-FB-Debug: x9eFwCGoMTtrbFPYiFLYT/3tJeopPK8zDQd83KEymtEOtjJ5Hrpxyslx6Q0E1ntiOoygQPM996cdJmjwARa3sA==
X-Firefox-Spdy: 3.1
 uncompressed-len 0   K